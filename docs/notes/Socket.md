<<<<<<< HEAD
[ğŸ‰ é»æ“Šè¨‚é–±é¢è©¦é€²éšå°ˆæ¬„ ](https://xiaozhuanlan.com/CyC2018)
=======
* [ç‚¹å‡»é˜…è¯»é¢è¯•è¿›é˜¶æŒ‡å— ](https://github.com/CyC2018/Backend-Interview-Guide)
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3
<!-- GFM-TOC -->
* [ä¸€ã€I/O æ¨¡å‹](#ä¸€io-æ¨¡å‹)
    * [é˜»å¡å¼ I/O](#é˜»å¡å¼-io)
    * [éé˜»å¡å¼ I/O](#éé˜»å¡å¼-io)
<<<<<<< HEAD
    * [I/O è¦†ç”¨](#io-è¦†ç”¨)
    * [ä¿¡è™Ÿé©…å‹• I/O](#ä¿¡è™Ÿé©…å‹•-io)
    * [ç•°æ­¥ I/O](#ç•°æ­¥-io)
    * [äº”å¤§ I/O æ¨¡å‹æ¯”è¼ƒ](#äº”å¤§-io-æ¨¡å‹æ¯”è¼ƒ)
* [äºŒã€I/O è¦†ç”¨](#äºŒio-è¦†ç”¨)
    * [select](#select)
    * [poll](#poll)
    * [æ¯”è¼ƒ](#æ¯”è¼ƒ)
    * [epoll](#epoll)
    * [å·¥ä½œæ¨¡å¼](#å·¥ä½œæ¨¡å¼)
    * [æ‡‰ç”¨å ´æ™¯](#æ‡‰ç”¨å ´æ™¯)
* [åƒè€ƒè³‡æ–™](#åƒè€ƒè³‡æ–™)
=======
    * [I/O å¤ç”¨](#io-å¤ç”¨)
    * [ä¿¡å·é©±åŠ¨ I/O](#ä¿¡å·é©±åŠ¨-io)
    * [å¼‚æ­¥ I/O](#å¼‚æ­¥-io)
    * [äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ](#äº”å¤§-io-æ¨¡å‹æ¯”è¾ƒ)
* [äºŒã€I/O å¤ç”¨](#äºŒio-å¤ç”¨)
    * [select](#select)
    * [poll](#poll)
    * [æ¯”è¾ƒ](#æ¯”è¾ƒ)
    * [epoll](#epoll)
    * [å·¥ä½œæ¨¡å¼](#å·¥ä½œæ¨¡å¼)
    * [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
* [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3
<!-- GFM-TOC -->


# ä¸€ã€I/O æ¨¡å‹

<<<<<<< HEAD
ä¸€å€‹è¼¸å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬å…©å€‹éšæ®µï¼š

- ç­‰å¾…æ•¸æ“šæº–å‚™å¥½
- å¾å…§æ ¸å‘é€²ç¨‹è¦†åˆ¶æ•¸æ“š

å°æ–¼ä¸€å€‹å¥—æ¥å­—ä¸Šçš„è¼¸å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•¸æ“šå¾ç¶²çµ¡ä¸­åˆ°é”ã€‚ç•¶æ‰€ç­‰å¾…æ•¸æ“šåˆ°é”æ™‚ï¼Œå®ƒè¢«è¦†åˆ¶åˆ°å…§æ ¸ä¸­çš„æŸå€‹ç·©æ²–å€ã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•¸æ“šå¾å…§æ ¸ç·©æ²–å€è¦†åˆ¶åˆ°æ‡‰ç”¨é€²ç¨‹ç·©æ²–å€ã€‚

Unix æœ‰äº”ç¨® I/O æ¨¡å‹ï¼š

- é˜»å¡å¼ I/O
- éé˜»å¡å¼ I/O
- I/O è¦†ç”¨ï¼ˆselect å’Œ pollï¼‰
- ä¿¡è™Ÿé©…å‹•å¼ I/Oï¼ˆSIGIOï¼‰
- ç•°æ­¥ I/Oï¼ˆAIOï¼‰

## é˜»å¡å¼ I/O

æ‡‰ç”¨é€²ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ•¸æ“šè¦†åˆ¶åˆ°æ‡‰ç”¨é€²ç¨‹ç·©æ²–å€ä¸­æ‰è¿”å›ã€‚

æ‡‰è©²è¨»æ„åˆ°ï¼Œåœ¨é˜»å¡çš„éç¨‹ä¸­ï¼Œå…¶å®ƒç¨‹åºé‚„å¯ä»¥åŸ·è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³è‘—æ•´å€‹æ“ä½œç³»çµ±éƒ½è¢«é˜»å¡ã€‚å› ç‚ºå…¶ä»–ç¨‹åºé‚„å¯ä»¥åŸ·è¡Œï¼Œæ‰€ä»¥ä¸æ¶ˆè€— CPU æ™‚é–“ï¼Œé€™ç¨®æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ•ˆç‡æœƒæ¯”è¼ƒé«˜ã€‚

ä¸‹åœ–ä¸­ï¼Œrecvfrom ç”¨æ–¼æ¥æ”¶ Socket å‚³ä¾†çš„æ•¸æ“šï¼Œä¸¦è¦†åˆ¶åˆ°æ‡‰ç”¨é€²ç¨‹çš„ç·©æ²–å€ buf ä¸­ã€‚é€™è£æŠŠ recvfrom() ç•¶æˆç³»çµ±èª¿ç”¨ã€‚
=======
ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š

- ç­‰å¾…æ•°æ®å‡†å¤‡å¥½
- ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ®

å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…æ•°æ®åˆ°è¾¾æ—¶ï¼Œå®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚

Unix æœ‰äº”ç§ I/O æ¨¡å‹ï¼š

- é˜»å¡å¼ I/O
- éé˜»å¡å¼ I/O
- I/O å¤ç”¨ï¼ˆselect å’Œ pollï¼‰
- ä¿¡å·é©±åŠ¨å¼ I/Oï¼ˆSIGIOï¼‰
- å¼‚æ­¥ I/Oï¼ˆAIOï¼‰

## é˜»å¡å¼ I/O

åº”ç”¨è¿›ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºä¸­æ‰è¿”å›ã€‚

åº”è¯¥æ³¨æ„åˆ°ï¼Œåœ¨é˜»å¡çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œå› æ­¤é˜»å¡ä¸æ„å‘³ç€æ•´ä¸ªæ“ä½œç³»ç»Ÿéƒ½è¢«é˜»å¡ã€‚å› ä¸ºå…¶å®ƒåº”ç”¨è¿›ç¨‹è¿˜å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸æ¶ˆè€— CPU æ—¶é—´ï¼Œè¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ•ˆç‡ä¼šæ¯”è¾ƒé«˜ã€‚

ä¸‹å›¾ä¸­ï¼Œrecvfrom() ç”¨äºæ¥æ”¶ Socket ä¼ æ¥çš„æ•°æ®ï¼Œå¹¶å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒº buf ä¸­ã€‚è¿™é‡ŒæŠŠ recvfrom() å½“æˆç³»ç»Ÿè°ƒç”¨ã€‚
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3

```c
ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen);
```

<div align="center"> <img src="pics/1492928416812_4.png"/> </div><br>

## éé˜»å¡å¼ I/O

<<<<<<< HEAD
æ‡‰ç”¨é€²ç¨‹åŸ·è¡Œç³»çµ±èª¿ç”¨ä¹‹å¾Œï¼Œå…§æ ¸è¿”å›ä¸€å€‹éŒ¯èª¤ç¢¼ã€‚æ‡‰ç”¨é€²ç¨‹å¯ä»¥ç¹¼çºŒåŸ·è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–·çš„åŸ·è¡Œç³»çµ±èª¿ç”¨ä¾†ç²çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œé€™ç¨®æ–¹å¼ç¨±ç‚ºè¼ªè©¢ï¼ˆpollingï¼‰ã€‚

ç”±æ–¼ CPU è¦è™•ç†æ›´å¤šçš„ç³»çµ±èª¿ç”¨ï¼Œå› æ­¤é€™ç¨®æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ˜¯æ¯”è¼ƒä½çš„ã€‚

<div align="center"> <img src="pics/1492929000361_5.png"/> </div><br>

## I/O è¦†ç”¨

ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•¸æ“šï¼Œä¸¦ä¸”å¯ä»¥ç­‰å¾…å¤šå€‹å¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€å€‹è®Šç‚ºå¯è®€ã€‚é€™ä¸€éç¨‹æœƒè¢«é˜»å¡ï¼Œç•¶æŸä¸€å€‹å¥—æ¥å­—å¯è®€æ™‚è¿”å›ï¼Œä¹‹å¾Œå†ä½¿ç”¨ recvfrom æŠŠæ•¸æ“šå¾å…§æ ¸è¦†åˆ¶åˆ°é€²ç¨‹ä¸­ã€‚

å®ƒå¯ä»¥è®“å–®å€‹é€²ç¨‹å…·æœ‰è™•ç†å¤šå€‹ I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç¨±ç‚º Event Driven I/Oï¼Œå³äº‹ä»¶é©…å‹• I/Oã€‚

å¦‚æœä¸€å€‹ Web æœå‹™å™¨æ²’æœ‰ I/O è¦†ç”¨ï¼Œé‚£éº½æ¯ä¸€å€‹ Socket é€£æ¥éƒ½éœ€è¦å‰µå»ºä¸€å€‹ç·šç¨‹å»è™•ç†ã€‚å¦‚æœåŒæ™‚æœ‰å¹¾è¬å€‹é€£æ¥ï¼Œé‚£éº½å°±éœ€è¦å‰µå»ºç›¸åŒæ•¸é‡çš„ç·šç¨‹ã€‚ç›¸æ¯”æ–¼å¤šé€²ç¨‹å’Œå¤šç·šç¨‹æŠ€è¡“ï¼ŒI/O è¦†ç”¨ä¸éœ€è¦é€²ç¨‹ç·šç¨‹å‰µå»ºå’Œåˆ‡æ›çš„é–‹éŠ·ï¼Œç³»çµ±é–‹éŠ·æ›´å°ã€‚

<div align="center"> <img src="pics/1492929444818_6.png"/> </div><br>

## ä¿¡è™Ÿé©…å‹• I/O

æ‡‰ç”¨é€²ç¨‹ä½¿ç”¨ sigaction ç³»çµ±èª¿ç”¨ï¼Œå…§æ ¸ç«‹å³è¿”å›ï¼Œæ‡‰ç”¨é€²ç¨‹å¯ä»¥ç¹¼çºŒåŸ·è¡Œï¼Œä¹Ÿå°±æ˜¯èªªç­‰å¾…æ•¸æ“šéšæ®µæ‡‰ç”¨é€²ç¨‹æ˜¯éé˜»å¡çš„ã€‚å…§æ ¸åœ¨æ•¸æ“šåˆ°é”æ™‚å‘æ‡‰ç”¨é€²ç¨‹ç™¼é€ SIGIO ä¿¡è™Ÿï¼Œæ‡‰ç”¨é€²ç¨‹æ”¶åˆ°ä¹‹å¾Œåœ¨ä¿¡è™Ÿè™•ç†ç¨‹åºä¸­èª¿ç”¨ recvfrom å°‡æ•¸æ“šå¾å…§æ ¸è¦†åˆ¶åˆ°æ‡‰ç”¨é€²ç¨‹ä¸­ã€‚

ç›¸æ¯”æ–¼éé˜»å¡å¼ I/O çš„è¼ªè©¢æ–¹å¼ï¼Œä¿¡è™Ÿé©…å‹• I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜ã€‚

<div align="center"> <img src="pics/1492929553651_7.png"/> </div><br>

## ç•°æ­¥ I/O

æ‡‰ç”¨é€²ç¨‹åŸ·è¡Œ aio_read ç³»çµ±èª¿ç”¨æœƒç«‹å³è¿”å›ï¼Œæ‡‰ç”¨é€²ç¨‹å¯ä»¥ç¹¼çºŒåŸ·è¡Œï¼Œä¸æœƒè¢«é˜»å¡ï¼Œå…§æ ¸æœƒåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹å¾Œå‘æ‡‰ç”¨é€²ç¨‹ç™¼é€ä¿¡è™Ÿã€‚

ç•°æ­¥ I/O èˆ‡ä¿¡è™Ÿé©…å‹• I/O çš„å€åˆ¥åœ¨æ–¼ï¼Œç•°æ­¥ I/O çš„ä¿¡è™Ÿæ˜¯é€šçŸ¥æ‡‰ç”¨é€²ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡è™Ÿé©…å‹• I/O çš„ä¿¡è™Ÿæ˜¯é€šçŸ¥æ‡‰ç”¨é€²ç¨‹å¯ä»¥é–‹å§‹ I/Oã€‚

<div align="center"> <img src="pics/1492930243286_8.png"/> </div><br>

## äº”å¤§ I/O æ¨¡å‹æ¯”è¼ƒ

- åŒæ­¥ I/Oï¼šå°‡æ•¸æ“šå¾å…§æ ¸ç·©æ²–å€è¦†åˆ¶åˆ°æ‡‰ç”¨é€²ç¨‹ç·©æ²–å€çš„éšæ®µï¼Œæ‡‰ç”¨é€²ç¨‹æœƒé˜»å¡ã€‚
- ç•°æ­¥ I/Oï¼šä¸æœƒé˜»å¡ã€‚

é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O è¦†ç”¨å’Œä¿¡è™Ÿé©…å‹• I/O éƒ½æ˜¯åŒæ­¥ I/Oï¼Œå®ƒå€‘çš„ä¸»è¦å€åˆ¥åœ¨ç¬¬ä¸€å€‹éšæ®µã€‚

éé˜»å¡å¼ I/O ã€ä¿¡è™Ÿé©…å‹• I/O å’Œç•°æ­¥ I/O åœ¨ç¬¬ä¸€éšæ®µä¸æœƒé˜»å¡ã€‚

<div align="center"> <img src="pics/1492928105791_3.png"/> </div><br>

# äºŒã€I/O è¦†ç”¨

select/poll/epoll éƒ½æ˜¯ I/O å¤šè·¯è¦†ç”¨çš„å…·é«”å¯¦ç¾ï¼Œselect å‡ºç¾çš„æœ€æ—©ï¼Œä¹‹å¾Œæ˜¯ pollï¼Œå†æ˜¯ epollã€‚
=======
åº”ç”¨è¿›ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªé”™è¯¯ç ã€‚åº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯éœ€è¦ä¸æ–­çš„æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ¥è·çŸ¥ I/O æ˜¯å¦å®Œæˆï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚

ç”±äº CPU è¦å¤„ç†æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› æ­¤è¿™ç§æ¨¡å‹çš„ CPU åˆ©ç”¨ç‡æ¯”è¾ƒä½ã€‚

<div align="center"> <img src="pics/1492929000361_5.png"/> </div><br>

## I/O å¤ç”¨

ä½¿ç”¨ select æˆ–è€… poll ç­‰å¾…æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥ç­‰å¾…å¤šä¸ªå¥—æ¥å­—ä¸­çš„ä»»ä½•ä¸€ä¸ªå˜ä¸ºå¯è¯»ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šè¢«é˜»å¡ï¼Œå½“æŸä¸€ä¸ªå¥—æ¥å­—å¯è¯»æ—¶è¿”å›ï¼Œä¹‹åå†ä½¿ç”¨ recvfrom æŠŠæ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è¿›ç¨‹ä¸­ã€‚

å®ƒå¯ä»¥è®©å•ä¸ªè¿›ç¨‹å…·æœ‰å¤„ç†å¤šä¸ª I/O äº‹ä»¶çš„èƒ½åŠ›ã€‚åˆè¢«ç§°ä¸º Event Driven I/Oï¼Œå³äº‹ä»¶é©±åŠ¨ I/Oã€‚

å¦‚æœä¸€ä¸ª Web æœåŠ¡å™¨æ²¡æœ‰ I/O å¤ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ª Socket è¿æ¥éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ã€‚å¦‚æœåŒæ—¶æœ‰å‡ ä¸‡ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºç›¸åŒæ•°é‡çš„çº¿ç¨‹ã€‚ç›¸æ¯”äºå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æŠ€æœ¯ï¼ŒI/O å¤ç”¨ä¸éœ€è¦è¿›ç¨‹çº¿ç¨‹åˆ›å»ºå’Œåˆ‡æ¢çš„å¼€é”€ï¼Œç³»ç»Ÿå¼€é”€æ›´å°ã€‚

<div align="center"> <img src="pics/1492929444818_6.png"/> </div><br>

## ä¿¡å·é©±åŠ¨ I/O

åº”ç”¨è¿›ç¨‹ä½¿ç”¨ sigaction ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰å¾…æ•°æ®é˜¶æ®µåº”ç”¨è¿›ç¨‹æ˜¯éé˜»å¡çš„ã€‚å†…æ ¸åœ¨æ•°æ®åˆ°è¾¾æ—¶å‘åº”ç”¨è¿›ç¨‹å‘é€ SIGIO ä¿¡å·ï¼Œåº”ç”¨è¿›ç¨‹æ”¶åˆ°ä¹‹ååœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨ recvfrom å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ä¸­ã€‚

ç›¸æ¯”äºéé˜»å¡å¼ I/O çš„è½®è¯¢æ–¹å¼ï¼Œä¿¡å·é©±åŠ¨ I/O çš„ CPU åˆ©ç”¨ç‡æ›´é«˜ã€‚

<div align="center"> <img src="pics/1492929553651_7.png"/> </div><br>

## å¼‚æ­¥ I/O

åº”ç”¨è¿›ç¨‹æ‰§è¡Œ aio_read ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šè¢«é˜»å¡ï¼Œå†…æ ¸ä¼šåœ¨æ‰€æœ‰æ“ä½œå®Œæˆä¹‹åå‘åº”ç”¨è¿›ç¨‹å‘é€ä¿¡å·ã€‚

å¼‚æ­¥ I/O ä¸ä¿¡å·é©±åŠ¨ I/O çš„åŒºåˆ«åœ¨äºï¼Œå¼‚æ­¥ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹ I/O å®Œæˆï¼Œè€Œä¿¡å·é©±åŠ¨ I/O çš„ä¿¡å·æ˜¯é€šçŸ¥åº”ç”¨è¿›ç¨‹å¯ä»¥å¼€å§‹ I/Oã€‚

<div align="center"> <img src="pics/1492930243286_8.png"/> </div><br>

## äº”å¤§ I/O æ¨¡å‹æ¯”è¾ƒ

- åŒæ­¥ I/Oï¼šå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºçš„é˜¶æ®µï¼Œåº”ç”¨è¿›ç¨‹ä¼šé˜»å¡ã€‚
- å¼‚æ­¥ I/Oï¼šä¸ä¼šé˜»å¡ã€‚

é˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤ç”¨å’Œä¿¡å·é©±åŠ¨ I/O éƒ½æ˜¯åŒæ­¥ I/Oï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚

éé˜»å¡å¼ I/O ã€ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/O åœ¨ç¬¬ä¸€é˜¶æ®µä¸ä¼šé˜»å¡ã€‚

<div align="center"> <img src="pics/1492928105791_3.png"/> </div><br>

# äºŒã€I/O å¤ç”¨

select/poll/epoll éƒ½æ˜¯ I/O å¤šè·¯å¤ç”¨çš„å…·ä½“å®ç°ï¼Œselect å‡ºç°çš„æœ€æ—©ï¼Œä¹‹åæ˜¯ pollï¼Œå†æ˜¯ epollã€‚
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3

## select

```c
int select(int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);
```

<<<<<<< HEAD
æœ‰ä¸‰ç¨®é¡å‹çš„æè¿°ç¬¦é¡å‹ï¼šreadsetã€writesetã€exceptsetï¼Œåˆ†åˆ¥å°æ‡‰è®€ã€å¯«ã€ç•°å¸¸æ¢ä»¶çš„æè¿°ç¬¦é›†åˆã€‚fd_set ä½¿ç”¨æ•¸çµ„å¯¦ç¾ï¼Œæ•¸çµ„å¤§å°ä½¿ç”¨ FD_SETSIZE å®šç¾©ã€‚

timeout ç‚ºè¶…æ™‚åƒæ•¸ï¼Œèª¿ç”¨ select æœƒä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æè¿°ç¬¦çš„äº‹ä»¶åˆ°é”æˆ–è€…ç­‰å¾…çš„æ™‚é–“è¶…é timeoutã€‚

æˆåŠŸèª¿ç”¨è¿”å›çµæœå¤§æ–¼ 0ï¼Œå‡ºéŒ¯è¿”å›çµæœç‚º -1ï¼Œè¶…æ™‚è¿”å›çµæœç‚º 0ã€‚
=======
æœ‰ä¸‰ç§ç±»å‹çš„æè¿°ç¬¦ç±»å‹ï¼šreadsetã€writesetã€exceptsetï¼Œåˆ†åˆ«å¯¹åº”è¯»ã€å†™ã€å¼‚å¸¸æ¡ä»¶çš„æè¿°ç¬¦é›†åˆã€‚fd_set ä½¿ç”¨æ•°ç»„å®ç°ï¼Œæ•°ç»„å¤§å°ä½¿ç”¨ FD_SETSIZE å®šä¹‰ã€‚

timeout ä¸ºè¶…æ—¶å‚æ•°ï¼Œè°ƒç”¨ select ä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰æè¿°ç¬¦çš„äº‹ä»¶åˆ°è¾¾æˆ–è€…ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ timeoutã€‚

æˆåŠŸè°ƒç”¨è¿”å›ç»“æœå¤§äº 0ï¼Œå‡ºé”™è¿”å›ç»“æœä¸º -1ï¼Œè¶…æ—¶è¿”å›ç»“æœä¸º 0ã€‚
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3

```c
fd_set fd_in, fd_out;
struct timeval tv;

// Reset the sets
FD_ZERO( &fd_in );
FD_ZERO( &fd_out );

// Monitor sock1 for input events
FD_SET( sock1, &fd_in );

// Monitor sock2 for output events
FD_SET( sock2, &fd_out );

// Find out which socket has the largest numeric value as select requires it
int largest_sock = sock1 > sock2 ? sock1 : sock2;

// Wait up to 10 seconds
tv.tv_sec = 10;
tv.tv_usec = 0;

// Call the select
int ret = select( largest_sock + 1, &fd_in, &fd_out, NULL, &tv );

// Check if select actually succeed
if ( ret == -1 )
    // report error and abort
else if ( ret == 0 )
    // timeout; no event detected
else
{
    if ( FD_ISSET( sock1, &fd_in ) )
        // input event on sock1

    if ( FD_ISSET( sock2, &fd_out ) )
        // output event on sock2
}
```

## poll

```c
int poll(struct pollfd *fds, unsigned int nfds, int timeout);
```

<<<<<<< HEAD
pollfd ä½¿ç”¨éˆè¡¨å¯¦ç¾ã€‚
=======
pollfd ä½¿ç”¨é“¾è¡¨å®ç°ã€‚
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3

```c
// The structure for two events
struct pollfd fds[2];

// Monitor sock1 for input
fds[0].fd = sock1;
fds[0].events = POLLIN;

// Monitor sock2 for output
fds[1].fd = sock2;
fds[1].events = POLLOUT;

// Wait 10 seconds
int ret = poll( &fds, 2, 10000 );
// Check if poll actually succeed
if ( ret == -1 )
    // report error and abort
else if ( ret == 0 )
    // timeout; no event detected
else
{
    // If we detect the event, zero it out so we can reuse the structure
    if ( fds[0].revents & POLLIN )
        fds[0].revents = 0;
        // input event on sock1

    if ( fds[1].revents & POLLOUT )
        fds[1].revents = 0;
        // output event on sock2
}
```

<<<<<<< HEAD
## æ¯”è¼ƒ

### 1. åŠŸèƒ½

select å’Œ poll çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä¸éåœ¨ä¸€äº›å¯¦ç¾ç´°ç¯€ä¸Šæœ‰æ‰€ä¸åŒã€‚

- select æœƒä¿®æ”¹æè¿°ç¬¦ï¼Œè€Œ poll ä¸æœƒï¼›
- select çš„æè¿°ç¬¦é¡å‹ä½¿ç”¨æ•¸çµ„å¯¦ç¾ï¼ŒFD_SETSIZE å¤§å°é»˜èªç‚º 1024ï¼Œå› æ­¤é»˜èªåªèƒ½ç›£è½ 1024 å€‹æè¿°ç¬¦ã€‚å¦‚æœè¦ç›£è½æ›´å¤šæè¿°ç¬¦çš„è©±ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹å¾Œé‡æ–°ç·¨è­¯ï¼›è€Œ poll çš„æè¿°ç¬¦é¡å‹ä½¿ç”¨éˆè¡¨å¯¦ç¾ï¼Œæ²’æœ‰æè¿°ç¬¦æ•¸é‡çš„é™åˆ¶ï¼›
- poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶é¡å‹ï¼Œä¸¦ä¸”å°æè¿°ç¬¦çš„é‡è¦†åˆ©ç”¨ä¸Šæ¯” select é«˜ã€‚
- å¦‚æœä¸€å€‹ç·šç¨‹å°æŸå€‹æè¿°ç¬¦èª¿ç”¨äº† select æˆ–è€… pollï¼Œå¦ä¸€å€‹ç·šç¨‹é—œé–‰äº†è©²æè¿°ç¬¦ï¼Œæœƒå°è‡´èª¿ç”¨çµæœä¸ç¢ºå®šã€‚

### 2. é€Ÿåº¦

select å’Œ poll é€Ÿåº¦éƒ½æ¯”è¼ƒæ…¢ã€‚

- select å’Œ poll æ¯æ¬¡èª¿ç”¨éƒ½éœ€è¦å°‡å…¨éƒ¨æè¿°ç¬¦å¾æ‡‰ç”¨é€²ç¨‹ç·©æ²–å€è¦†åˆ¶åˆ°å…§æ ¸ç·©æ²–å€ã€‚
- select å’Œ poll çš„è¿”å›çµæœä¸­æ²’æœ‰è²æ˜å“ªäº›æè¿°ç¬¦å·²ç¶“æº–å‚™å¥½ï¼Œæ‰€ä»¥å¦‚æœè¿”å›å€¼å¤§æ–¼ 0 æ™‚ï¼Œæ‡‰ç”¨é€²ç¨‹éƒ½éœ€è¦ä½¿ç”¨è¼ªè©¢çš„æ–¹å¼ä¾†æ‰¾åˆ° I/O å®Œæˆçš„æè¿°ç¬¦ã€‚

### 3. å¯ç§»æ¤æ€§

å¹¾ä¹æ‰€æœ‰çš„ç³»çµ±éƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¼ƒæ–°çš„ç³»çµ±æ”¯æŒ pollã€‚
=======
## æ¯”è¾ƒ

### 1. åŠŸèƒ½

select å’Œ poll çš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä¸è¿‡åœ¨ä¸€äº›å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚

- select ä¼šä¿®æ”¹æè¿°ç¬¦ï¼Œè€Œ poll ä¸ä¼šï¼›
- select çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨æ•°ç»„å®ç°ï¼ŒFD_SETSIZE å¤§å°é»˜è®¤ä¸º 1024ï¼Œå› æ­¤é»˜è®¤åªèƒ½ç›‘å¬ 1024 ä¸ªæè¿°ç¬¦ã€‚å¦‚æœè¦ç›‘å¬æ›´å¤šæè¿°ç¬¦çš„è¯ï¼Œéœ€è¦ä¿®æ”¹ FD_SETSIZE ä¹‹åé‡æ–°ç¼–è¯‘ï¼›è€Œ poll çš„æè¿°ç¬¦ç±»å‹ä½¿ç”¨é“¾è¡¨å®ç°ï¼Œæ²¡æœ‰æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼›
- poll æä¾›äº†æ›´å¤šçš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ä¸”å¯¹æè¿°ç¬¦çš„é‡å¤åˆ©ç”¨ä¸Šæ¯” select é«˜ã€‚
- å¦‚æœä¸€ä¸ªçº¿ç¨‹å¯¹æŸä¸ªæè¿°ç¬¦è°ƒç”¨äº† select æˆ–è€… pollï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†è¯¥æè¿°ç¬¦ï¼Œä¼šå¯¼è‡´è°ƒç”¨ç»“æœä¸ç¡®å®šã€‚

### 2. é€Ÿåº¦

select å’Œ poll é€Ÿåº¦éƒ½æ¯”è¾ƒæ…¢ã€‚

- select å’Œ poll æ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å°†å…¨éƒ¨æè¿°ç¬¦ä»åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºã€‚
- select å’Œ poll çš„è¿”å›ç»“æœä¸­æ²¡æœ‰å£°æ˜å“ªäº›æè¿°ç¬¦å·²ç»å‡†å¤‡å¥½ï¼Œæ‰€ä»¥å¦‚æœè¿”å›å€¼å¤§äº 0 æ—¶ï¼Œåº”ç”¨è¿›ç¨‹éƒ½éœ€è¦ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ¥æ‰¾åˆ° I/O å®Œæˆçš„æè¿°ç¬¦ã€‚

### 3. å¯ç§»æ¤æ€§

å‡ ä¹æ‰€æœ‰çš„ç³»ç»Ÿéƒ½æ”¯æŒ selectï¼Œä½†æ˜¯åªæœ‰æ¯”è¾ƒæ–°çš„ç³»ç»Ÿæ”¯æŒ pollã€‚
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3

## epoll

```c
int epoll_create(int size);
int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›
int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);
```

<<<<<<< HEAD
epoll_ctl() ç”¨æ–¼å‘å…§æ ¸è¨»å†Šæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹è®ŠæŸå€‹æ–‡ä»¶æè¿°ç¬¦çš„ç‹€æ…‹ã€‚å·²è¨»å†Šçš„æè¿°ç¬¦åœ¨å…§æ ¸ä¸­æœƒè¢«ç¶­è­·åœ¨ä¸€æ£µç´…é»‘æ¨¹ä¸Šï¼Œé€šéå›èª¿å‡½æ•¸å…§æ ¸æœƒå°‡ I/O æº–å‚™å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€å€‹éˆè¡¨ä¸­ç®¡ç†ï¼Œé€²ç¨‹èª¿ç”¨ epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚

å¾ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œepoll åªéœ€è¦å°‡æè¿°ç¬¦å¾é€²ç¨‹ç·©æ²–å€å‘å…§æ ¸ç·©æ²–å€æ‹·è²ä¸€æ¬¡ï¼Œä¸¦ä¸”é€²ç¨‹ä¸éœ€è¦é€šéè¼ªè©¢ä¾†ç²å¾—äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚

epoll åƒ…é©ç”¨æ–¼ Linux OSã€‚

epoll æ¯” select å’Œ poll æ›´åŠ éˆæ´»è€Œä¸”æ²’æœ‰æè¿°ç¬¦æ•¸é‡é™åˆ¶ã€‚

epoll å°å¤šç·šç¨‹ç·¨ç¨‹æ›´æœ‰å‹å¥½ï¼Œä¸€å€‹ç·šç¨‹èª¿ç”¨äº† epoll_wait() å¦ä¸€å€‹ç·šç¨‹é—œé–‰äº†åŒä¸€å€‹æè¿°ç¬¦ä¹Ÿä¸æœƒç”¢ç”Ÿåƒ select å’Œ poll çš„ä¸ç¢ºå®šæƒ…æ³ã€‚
=======
epoll_ctl() ç”¨äºå‘å†…æ ¸æ³¨å†Œæ–°çš„æè¿°ç¬¦æˆ–è€…æ˜¯æ”¹å˜æŸä¸ªæ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚å·²æ³¨å†Œçš„æè¿°ç¬¦åœ¨å†…æ ¸ä¸­ä¼šè¢«ç»´æŠ¤åœ¨ä¸€æ£µçº¢é»‘æ ‘ä¸Šï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°† I/O å‡†å¤‡å¥½çš„æè¿°ç¬¦åŠ å…¥åˆ°ä¸€ä¸ªé“¾è¡¨ä¸­ç®¡ç†ï¼Œè¿›ç¨‹è°ƒç”¨ epoll_wait() ä¾¿å¯ä»¥å¾—åˆ°äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚

ä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œepoll åªéœ€è¦å°†æè¿°ç¬¦ä»è¿›ç¨‹ç¼“å†²åŒºå‘å†…æ ¸ç¼“å†²åŒºæ‹·è´ä¸€æ¬¡ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸éœ€è¦é€šè¿‡è½®è¯¢æ¥è·å¾—äº‹ä»¶å®Œæˆçš„æè¿°ç¬¦ã€‚

epoll ä»…é€‚ç”¨äº Linux OSã€‚

epoll æ¯” select å’Œ poll æ›´åŠ çµæ´»è€Œä¸”æ²¡æœ‰æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚

epoll å¯¹å¤šçº¿ç¨‹ç¼–ç¨‹æ›´æœ‰å‹å¥½ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨äº† epoll_wait() å¦ä¸€ä¸ªçº¿ç¨‹å…³é—­äº†åŒä¸€ä¸ªæè¿°ç¬¦ä¹Ÿä¸ä¼šäº§ç”Ÿåƒ select å’Œ poll çš„ä¸ç¡®å®šæƒ…å†µã€‚
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3

```c
// Create the epoll descriptor. Only one is needed per app, and is used to monitor all sockets.
// The function argument is ignored (it was not before, but now it is), so put your favorite number here
int pollingfd = epoll_create( 0xCAFE );

if ( pollingfd < 0 )
 // report error

// Initialize the epoll structure in case more members are added in future
struct epoll_event ev = { 0 };

// Associate the connection class instance with the event. You can associate anything
// you want, epoll does not use this information. We store a connection class pointer, pConnection1
ev.data.ptr = pConnection1;

// Monitor for input, and do not automatically rearm the descriptor after the event
ev.events = EPOLLIN | EPOLLONESHOT;
// Add the descriptor into the monitoring list. We can do it even if another thread is
// waiting in epoll_wait - the descriptor will be properly added
if ( epoll_ctl( epollfd, EPOLL_CTL_ADD, pConnection1->getSocket(), &ev ) != 0 )
    // report error

// Wait for up to 20 events (assuming we have added maybe 200 sockets before that it may happen)
struct epoll_event pevents[ 20 ];

// Wait for 10 seconds, and retrieve less than 20 epoll_event and store them into epoll_event array
int ready = epoll_wait( pollingfd, pevents, 20, 10000 );
// Check if epoll actually succeed
if ( ret == -1 )
    // report error and abort
else if ( ret == 0 )
    // timeout; no event detected
else
{
    // Check if any events detected
    for ( int i = 0; i < ret; i++ )
    {
        if ( pevents[i].events & EPOLLIN )
        {
            // Get back our connection pointer
            Connection * c = (Connection*) pevents[i].data.ptr;
            c->handleReadEvent();
         }
    }
}
```


## å·¥ä½œæ¨¡å¼

<<<<<<< HEAD
epoll çš„æè¿°ç¬¦äº‹ä»¶æœ‰å…©ç¨®è§¸ç™¼æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚

### 1. LT æ¨¡å¼

ç•¶ epoll_wait() æª¢æ¸¬åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°é”æ™‚ï¼Œå°‡æ­¤äº‹ä»¶é€šçŸ¥é€²ç¨‹ï¼Œé€²ç¨‹å¯ä»¥ä¸ç«‹å³è™•ç†è©²äº‹ä»¶ï¼Œä¸‹æ¬¡èª¿ç”¨ epoll_wait() æœƒå†æ¬¡é€šçŸ¥é€²ç¨‹ã€‚æ˜¯é»˜èªçš„ä¸€ç¨®æ¨¡å¼ï¼Œä¸¦ä¸”åŒæ™‚æ”¯æŒ Blocking å’Œ No-Blockingã€‚

### 2. ET æ¨¡å¼

å’Œ LT æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé€šçŸ¥ä¹‹å¾Œé€²ç¨‹å¿…é ˆç«‹å³è™•ç†äº‹ä»¶ï¼Œä¸‹æ¬¡å†èª¿ç”¨ epoll_wait() æ™‚ä¸æœƒå†å¾—åˆ°äº‹ä»¶åˆ°é”çš„é€šçŸ¥ã€‚

å¾ˆå¤§ç¨‹åº¦ä¸Šæ¸›å°‘äº† epoll äº‹ä»¶è¢«é‡è¦†è§¸ç™¼çš„æ¬¡æ•¸ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±æ–¼ä¸€å€‹æ–‡ä»¶å¥æŸ„çš„é˜»å¡è®€/é˜»å¡å¯«æ“ä½œæŠŠè™•ç†å¤šå€‹æ–‡ä»¶æè¿°ç¬¦çš„ä»»å‹™é¤“æ­»ã€‚

## æ‡‰ç”¨å ´æ™¯

å¾ˆå®¹æ˜“ç”¢ç”Ÿä¸€ç¨®éŒ¯è¦ºèªç‚ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect å’Œ poll éƒ½å·²ç¶“éæ™‚äº†ï¼Œå…¶å¯¦å®ƒå€‘éƒ½æœ‰å„è‡ªçš„ä½¿ç”¨å ´æ™¯ã€‚

### 1. select æ‡‰ç”¨å ´æ™¯

select çš„ timeout åƒæ•¸ç²¾åº¦ç‚º 1nsï¼Œè€Œ poll å’Œ epoll ç‚º 1msï¼Œå› æ­¤ select æ›´åŠ é©ç”¨æ–¼å¯¦æ™‚æ€§è¦æ±‚æ¯”è¼ƒé«˜çš„å ´æ™¯ï¼Œæ¯”å¦‚æ ¸åæ‡‰å †çš„æ§åˆ¶ã€‚

select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå¹¾ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚

### 2. poll æ‡‰ç”¨å ´æ™¯

poll æ²’æœ‰æœ€å¤§æè¿°ç¬¦æ•¸é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒä¸¦ä¸”å°å¯¦æ™‚æ€§è¦æ±‚ä¸é«˜ï¼Œæ‡‰è©²ä½¿ç”¨ poll è€Œä¸æ˜¯ selectã€‚

### 3. epoll æ‡‰ç”¨å ´æ™¯

åªéœ€è¦é‹è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ™‚è¼ªè©¢ï¼Œä¸¦ä¸”é€™äº›é€£æ¥æœ€å¥½æ˜¯é•·é€£æ¥ã€‚

éœ€è¦åŒæ™‚ç›£æ§å°æ–¼ 1000 å€‹æè¿°ç¬¦ï¼Œå°±æ²’æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ç‚ºé€™å€‹æ‡‰ç”¨å ´æ™¯ä¸‹ä¸¦ä¸èƒ½é«”ç¾ epoll çš„å„ªå‹¢ã€‚

éœ€è¦ç›£æ§çš„æè¿°ç¬¦ç‹€æ…‹è®ŠåŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš«çš„ï¼Œä¹Ÿæ²’æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ç‚º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å„²åœ¨å…§æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å°æè¿°ç¬¦çš„ç‹€æ…‹æ”¹è®Šéƒ½éœ€è¦é€šé epoll_ctl() é€²è¡Œç³»çµ±èª¿ç”¨ï¼Œé »ç¹ç³»çµ±èª¿ç”¨é™ä½æ•ˆç‡ã€‚ä¸¦ä¸” epoll çš„æè¿°ç¬¦å­˜å„²åœ¨å…§æ ¸ï¼Œä¸å®¹æ˜“èª¿è©¦ã€‚

# åƒè€ƒè³‡æ–™
=======
epoll çš„æè¿°ç¬¦äº‹ä»¶æœ‰ä¸¤ç§è§¦å‘æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’Œ ETï¼ˆedge triggerï¼‰ã€‚

### 1. LT æ¨¡å¼

å½“ epoll_wait() æ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶åˆ°è¾¾æ—¶ï¼Œå°†æ­¤äº‹ä»¶é€šçŸ¥è¿›ç¨‹ï¼Œè¿›ç¨‹å¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œä¸‹æ¬¡è°ƒç”¨ epoll_wait() ä¼šå†æ¬¡é€šçŸ¥è¿›ç¨‹ã€‚æ˜¯é»˜è®¤çš„ä¸€ç§æ¨¡å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒ Blocking å’Œ No-Blockingã€‚

### 2. ET æ¨¡å¼

å’Œ LT æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé€šçŸ¥ä¹‹åè¿›ç¨‹å¿…é¡»ç«‹å³å¤„ç†äº‹ä»¶ï¼Œä¸‹æ¬¡å†è°ƒç”¨ epoll_wait() æ—¶ä¸ä¼šå†å¾—åˆ°äº‹ä»¶åˆ°è¾¾çš„é€šçŸ¥ã€‚

å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº† epoll äº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯” LT æ¨¡å¼é«˜ã€‚åªæ”¯æŒ No-Blockingï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚

## åº”ç”¨åœºæ™¯

å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ç§é”™è§‰è®¤ä¸ºåªè¦ç”¨ epoll å°±å¯ä»¥äº†ï¼Œselect å’Œ poll éƒ½å·²ç»è¿‡æ—¶äº†ï¼Œå…¶å®å®ƒä»¬éƒ½æœ‰å„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚

### 1. select åº”ç”¨åœºæ™¯

select çš„ timeout å‚æ•°ç²¾åº¦ä¸º 1nsï¼Œè€Œ poll å’Œ epoll ä¸º 1msï¼Œå› æ­¤ select æ›´åŠ é€‚ç”¨äºå®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æ ¸ååº”å †çš„æ§åˆ¶ã€‚

select å¯ç§»æ¤æ€§æ›´å¥½ï¼Œå‡ ä¹è¢«æ‰€æœ‰ä¸»æµå¹³å°æ‰€æ”¯æŒã€‚

### 2. poll åº”ç”¨åœºæ™¯

poll æ²¡æœ‰æœ€å¤§æè¿°ç¬¦æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœå¹³å°æ”¯æŒå¹¶ä¸”å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œåº”è¯¥ä½¿ç”¨ poll è€Œä¸æ˜¯ selectã€‚

### 3. epoll åº”ç”¨åœºæ™¯

åªéœ€è¦è¿è¡Œåœ¨ Linux å¹³å°ä¸Šï¼Œæœ‰å¤§é‡çš„æè¿°ç¬¦éœ€è¦åŒæ—¶è½®è¯¢ï¼Œå¹¶ä¸”è¿™äº›è¿æ¥æœ€å¥½æ˜¯é•¿è¿æ¥ã€‚

éœ€è¦åŒæ—¶ç›‘æ§å°äº 1000 ä¸ªæè¿°ç¬¦ï¼Œå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ epollï¼Œå› ä¸ºè¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹å¹¶ä¸èƒ½ä½“ç° epoll çš„ä¼˜åŠ¿ã€‚

éœ€è¦ç›‘æ§çš„æè¿°ç¬¦çŠ¶æ€å˜åŒ–å¤šï¼Œè€Œä¸”éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ä½¿ç”¨ epollã€‚å› ä¸º epoll ä¸­çš„æ‰€æœ‰æè¿°ç¬¦éƒ½å­˜å‚¨åœ¨å†…æ ¸ä¸­ï¼Œé€ æˆæ¯æ¬¡éœ€è¦å¯¹æè¿°ç¬¦çš„çŠ¶æ€æ”¹å˜éƒ½éœ€è¦é€šè¿‡ epoll_ctl() è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé¢‘ç¹ç³»ç»Ÿè°ƒç”¨é™ä½æ•ˆç‡ã€‚å¹¶ä¸” epoll çš„æè¿°ç¬¦å­˜å‚¨åœ¨å†…æ ¸ï¼Œä¸å®¹æ˜“è°ƒè¯•ã€‚

# å‚è€ƒèµ„æ–™
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3

- Stevens W R, Fenner B, Rudoff A M. UNIX network programming[M]. Addison-Wesley Professional, 2004.
- [Boost application performance using asynchronous I/O](https://www.ibm.com/developerworks/linux/library/l-async/)
- [Synchronous and Asynchronous I/O](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365683(v=vs.85).aspx)
<<<<<<< HEAD
- [Linux IO æ¨¡å¼åŠ selectã€pollã€epoll è©³è§£](https://segmentfault.com/a/1190000003063859)
=======
- [Linux IO æ¨¡å¼åŠ selectã€pollã€epoll è¯¦è§£](https://segmentfault.com/a/1190000003063859)
>>>>>>> 9f1571a1b578332969a00a0bda4029dfad9995a3
- [poll vs select vs event-based](https://daniel.haxx.se/docs/poll-vs-select.html)
- [select / poll / epoll: practical difference for system architects](http://www.ulduzsoft.com/2014/01/select-poll-epoll-practical-difference-for-system-architects/)
- [Browse the source code of userspace/glibc/sysdeps/unix/sysv/linux/ online](https://code.woboq.org/userspace/glibc/sysdeps/unix/sysv/linux/)
